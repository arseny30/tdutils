#include "unicode.h"

#include <algorithm>
#include <iterator>
#include <limits>

namespace td {

// list of [(range_begin << 5) + range_type]
static const uint32 unicode_simple_category_ranges[] = {
    0,       1028,    1056,    1538,    1856,    2081,    2912,    3105,
    3936,    5124,    5152,    5441,    5472,    5699,    5760,    5793,
    5824,    5923,    5953,    5984,    6019,    6112,    6145,    6880,
    6913,    7904,    7937,    22592,   22721,   23104,   23553,   23712,
    23937,   23968,   24001,   24032,   28161,   28320,   28353,   28416,
    28481,   28608,   28641,   28672,   28865,   28896,   28929,   29024,
    29057,   29088,   29121,   29760,   29793,   32448,   32481,   36928,
    37185,   42496,   42529,   43744,   43809,   43840,   44065,   45312,
    47617,   48480,   48641,   48736,   50177,   51552,   52226,   52544,
    52673,   52736,   52769,   55936,   55969,   56000,   56481,   56544,
    56769,   56834,   57153,   57248,   57313,   57344,   57857,   57888,
    57921,   58880,   59809,   62656,   63009,   63040,   63490,   63809,
    64864,   65153,   65216,   65345,   65376,   65537,   66240,   66369,
    66400,   66689,   66720,   66817,   66848,   67585,   68384,   70657,
    71328,   71361,   71616,   73857,   75584,   75681,   75712,   76289,
    76320,   76545,   76864,   76994,   77312,   77345,   77856,   77985,
    78240,   78305,   78368,   78433,   79136,   79169,   79392,   79425,
    79456,   79553,   79680,   79777,   79808,   80321,   80352,   80769,
    80832,   80865,   80960,   81090,   81409,   81472,   81539,   81728,
    82081,   82272,   82401,   82464,   82529,   83232,   83265,   83488,
    83521,   83584,   83617,   83680,   83713,   83776,   84769,   84896,
    84929,   84960,   85186,   85504,   85569,   85664,   86177,   86464,
    86497,   86592,   86625,   87328,   87361,   87584,   87617,   87680,
    87713,   87872,   87969,   88000,   88577,   88608,   89089,   89152,
    89282,   89600,   89889,   89920,   90273,   90528,   90593,   90656,
    90721,   91424,   91457,   91680,   91713,   91776,   91809,   91968,
    92065,   92096,   93057,   93120,   93153,   93248,   93378,   93696,
    93729,   93763,   93952,   94305,   94336,   94369,   94560,   94657,
    94752,   94785,   94912,   95009,   95072,   95105,   95136,   95169,
    95232,   95329,   95392,   95489,   95584,   95681,   96064,   96769,
    96800,   97474,   97795,   97888,   98465,   98720,   98753,   98848,
    98881,   99616,   99649,   100160,  100257,  100288,  101121,  101216,
    101377,  101440,  101570,  101888,  102147,  102368,  102401,  102432,
    102561,  102816,  102849,  102944,  102977,  103712,  103745,  104064,
    104097,  104256,  104353,  104384,  105409,  105440,  105473,  105536,
    105666,  105984,  106017,  106080,  106657,  106912,  106945,  107040,
    107073,  108384,  108449,  108480,  108993,  109024,  109185,  109280,
    109315,  109537,  109632,  109762,  110083,  110368,  110401,  110592,
    110753,  111328,  111425,  112192,  112225,  112512,  112545,  112576,
    112641,  112864,  113858,  114176,  114721,  116256,  116289,  116352,
    116737,  116960,  117250,  117568,  118817,  118880,  118913,  118944,
    119009,  119072,  119105,  119136,  119201,  119232,  119425,  119552,
    119585,  119808,  119841,  119936,  119969,  120000,  120033,  120064,
    120129,  120192,  120225,  120352,  120385,  120448,  120737,  120768,
    120833,  120992,  121025,  121056,  121346,  121664,  121729,  121856,
    122881,  122912,  123906,  124227,  124544,  124929,  125184,  125217,
    126368,  127233,  127392,  131073,  132448,  133089,  133122,  133440,
    133633,  133824,  133953,  134080,  134177,  134208,  134305,  134368,
    134593,  134688,  134817,  135232,  135617,  135648,  135682,  136000,
    136193,  137408,  137441,  137472,  137633,  137664,  137729,  139104,
    139137,  149792,  149825,  149952,  150017,  150240,  150273,  150304,
    150337,  150464,  150529,  151840,  151873,  152000,  152065,  153120,
    153153,  153280,  153345,  153568,  153601,  153632,  153665,  153792,
    153857,  154336,  154369,  156192,  156225,  156352,  156417,  158560,
    159011,  159648,  159745,  160256,  160769,  163520,  163585,  163776,
    163873,  183712,  183777,  184324,  184353,  185184,  185345,  187744,
    187843,  187937,  188192,  188417,  188832,  188865,  188992,  189441,
    190016,  190465,  191040,  191489,  191904,  191937,  192032,  192513,
    194176,  195297,  195328,  195457,  195488,  195586,  195904,  196099,
    196416,  197122,  197440,  197633,  200448,  200705,  200864,  200929,
    202016,  202049,  202080,  202241,  204480,  204801,  205792,  207042,
    207361,  208320,  208385,  208544,  208897,  210304,  210433,  211264,
    211458,  211779,  211808,  212993,  213728,  214017,  215712,  217090,
    217408,  217602,  217920,  218337,  218368,  221345,  222848,  223393,
    223616,  223746,  224064,  225377,  226336,  226753,  226818,  227137,
    228544,  229377,  230528,  231426,  231744,  231841,  231938,  232257,
    233408,  233473,  233760,  236833,  236960,  236993,  237120,  237217,
    237280,  237569,  243712,  245761,  254656,  254721,  254912,  254977,
    256192,  256257,  256448,  256513,  256768,  256801,  256832,  256865,
    256896,  256929,  256960,  256993,  257984,  258049,  259744,  259777,
    260000,  260033,  260064,  260161,  260256,  260289,  260512,  260609,
    260736,  260801,  260992,  261121,  261536,  261697,  261792,  261825,
    262048,  262148,  262496,  263428,  263488,  263652,  263680,  265188,
    265216,  265731,  265761,  265792,  265859,  266048,  266209,  266243,
    266560,  266753,  267168,  270401,  270432,  270561,  270592,  270657,
    270976,  271009,  271040,  271137,  271296,  271489,  271520,  271553,
    271584,  271617,  271648,  271681,  271808,  271841,  272192,  272257,
    272384,  272545,  272704,  272833,  272864,  272899,  274529,  274595,
    274752,  297987,  299904,  302403,  303104,  323267,  324224,  360449,
    361952,  361985,  363488,  363521,  367776,  367969,  368096,  368193,
    368256,  368547,  368576,  368641,  369856,  369889,  369920,  370081,
    370112,  370177,  371968,  372193,  372224,  372737,  373472,  373761,
    373984,  374017,  374240,  374273,  374496,  374529,  374752,  374785,
    375008,  375041,  375264,  375297,  375520,  375553,  375776,  378337,
    378368,  393220,  393248,  393377,  393443,  393472,  394275,  394560,
    394785,  394944,  395011,  395105,  395168,  395297,  398048,  398241,
    398336,  398369,  401248,  401281,  401408,  401569,  402880,  402977,
    405984,  406083,  406208,  406529,  407392,  409089,  409600,  410627,
    410944,  411907,  412160,  412195,  412672,  413699,  414016,  415267,
    415744,  425985,  636608,  638977,  1309376, 1310721, 1348000, 1350145,
    1351616, 1351681, 1360288, 1360385, 1360898, 1361217, 1361280, 1361921,
    1363424, 1363937, 1364928, 1364993, 1367235, 1367552, 1368801, 1369088,
    1369153, 1372448, 1372513, 1373664, 1373697, 1373952, 1375969, 1376320,
    1376353, 1376448, 1376481, 1376608, 1376641, 1377376, 1377795, 1377984,
    1378305, 1379968, 1380417, 1382016, 1382914, 1383232, 1384001, 1384192,
    1384289, 1384320, 1384353, 1384384, 1384450, 1384769, 1385664, 1385985,
    1386720, 1387521, 1388448, 1388673, 1390176, 1391073, 1391106, 1391424,
    1391617, 1391776, 1391809, 1392130, 1392449, 1392608, 1392641, 1393952,
    1394689, 1394784, 1394817, 1395072, 1395202, 1395520, 1395713, 1396448,
    1396545, 1396576, 1396673, 1398272, 1398305, 1398336, 1398433, 1398496,
    1398561, 1398720, 1398785, 1398816, 1398849, 1398880, 1399649, 1399744,
    1399809, 1400160, 1400385, 1400480, 1400865, 1401056, 1401121, 1401312,
    1401377, 1401568, 1401857, 1402080, 1402113, 1402336, 1402369, 1403744,
    1403777, 1404096, 1404417, 1408096, 1408514, 1408832, 1409025, 1766528,
    1766913, 1767648, 1767777, 1769344, 2039809, 2051520, 2051585, 2054976,
    2056193, 2056416, 2056801, 2056960, 2057121, 2057152, 2057185, 2057504,
    2057537, 2057952, 2057985, 2058144, 2058177, 2058208, 2058241, 2058304,
    2058337, 2058400, 2058433, 2061888, 2062945, 2074560, 2075137, 2077184,
    2077249, 2078976, 2080257, 2080640, 2084353, 2084512, 2084545, 2088864,
    2089474, 2089792, 2090017, 2090848, 2091041, 2091872, 2092225, 2095072,
    2095169, 2095360, 2095425, 2095616, 2095681, 2095872, 2095937, 2096032,
    2097153, 2097536, 2097569, 2098400, 2098433, 2099040, 2099073, 2099136,
    2099169, 2099648, 2099713, 2100160, 2101249, 2105184, 2105571, 2107008,
    2107395, 2109216, 2109763, 2109824, 2117633, 2118560, 2118657, 2120224,
    2120739, 2121600, 2121729, 2122755, 2122880, 2123265, 2123811, 2123841,
    2124099, 2124128, 2124289, 2125504, 2125825, 2126784, 2126849, 2128000,
    2128129, 2128384, 2128419, 2128576, 2129921, 2134976, 2135042, 2135360,
    2135553, 2136704, 2136833, 2137984, 2138113, 2139392, 2139649, 2141312,
    2146305, 2156256, 2156545, 2157248, 2157569, 2157824, 2162689, 2162880,
    2162945, 2162976, 2163009, 2164416, 2164449, 2164512, 2164609, 2164640,
    2164705, 2165440, 2165507, 2165761, 2166496, 2166563, 2166785, 2167776,
    2168035, 2168320, 2169857, 2170464, 2170497, 2170560, 2170723, 2170881,
    2171587, 2171776, 2171905, 2172736, 2174977, 2176768, 2176899, 2176961,
    2177027, 2177536, 2177603, 2179073, 2179104, 2179585, 2179712, 2179745,
    2179840, 2179873, 2180736, 2181123, 2181376, 2182145, 2183075, 2183136,
    2183169, 2184099, 2184192, 2185217, 2185472, 2185505, 2186400, 2186595,
    2186752, 2187265, 2188992, 2189313, 2190016, 2190083, 2190337, 2190944,
    2191107, 2191361, 2191936, 2192675, 2192896, 2195457, 2197792, 2199553,
    2201184, 2201601, 2203232, 2203459, 2203648, 2214915, 2215904, 2228321,
    2230016, 2230851, 2231490, 2231808, 2232417, 2233856, 2234881, 2235680,
    2235906, 2236224, 2236513, 2237664, 2238146, 2238464, 2238977, 2240096,
    2240193, 2240224, 2240609, 2242144, 2242593, 2242720, 2243074, 2243393,
    2243424, 2243457, 2243488, 2243619, 2244256, 2244609, 2245184, 2245217,
    2246016, 2248705, 2248928, 2248961, 2248992, 2249025, 2249152, 2249185,
    2249664, 2249697, 2250016, 2250241, 2251744, 2252290, 2252608, 2252961,
    2253216, 2253281, 2253344, 2253409, 2254112, 2254145, 2254368, 2254401,
    2254464, 2254497, 2254656, 2254753, 2254784, 2255361, 2255392, 2255777,
    2255936, 2260993, 2262688, 2263265, 2263392, 2263554, 2263872, 2265089,
    2266624, 2267265, 2267328, 2267361, 2267392, 2267650, 2267968, 2273281,
    2274784, 2276097, 2276224, 2277377, 2278912, 2279553, 2279584, 2279938,
    2280256, 2281473, 2282848, 2283522, 2283840, 2285569, 2286400, 2287106,
    2287427, 2287488, 2298881, 2300930, 2301251, 2301536, 2301921, 2301952,
    2316289, 2318112, 2326529, 2326816, 2326849, 2328032, 2328577, 2328608,
    2329090, 2329411, 2330016, 2330177, 2331136, 2359297, 2388800, 2392067,
    2395616, 2396161, 2402432, 2490369, 2524640, 2654209, 2672864, 2949121,
    2967328, 2967553, 2968544, 2968578, 2968896, 2972161, 2973120, 2973697,
    2975232, 2975745, 2975872, 2976258, 2976576, 2976611, 2976832, 2976865,
    2977536, 2977697, 2978304, 3006465, 3008672, 3009025, 3009056, 3011169,
    3011584, 3013633, 3013664, 3014657, 3210656, 3211265, 3235424, 3538945,
    3539008, 3637249, 3640672, 3640833, 3641248, 3641345, 3641632, 3641857,
    3642176, 3828739, 3829312, 3833857, 3836576, 3836609, 3838880, 3838913,
    3838976, 3839041, 3839072, 3839137, 3839200, 3839265, 3839392, 3839425,
    3839808, 3839841, 3839872, 3839905, 3840128, 3840161, 3842240, 3842273,
    3842400, 3842465, 3842720, 3842753, 3842976, 3843009, 3843904, 3843937,
    3844064, 3844097, 3844256, 3844289, 3844320, 3844417, 3844640, 3844673,
    3855552, 3855617, 3856416, 3856449, 3857248, 3857281, 3858272, 3858305,
    3859104, 3859137, 3860128, 3860161, 3860960, 3860993, 3861984, 3862017,
    3862816, 3862849, 3863840, 3863873, 3864672, 3864705, 3864960, 3865026,
    3866624, 3997697, 4004000, 4004067, 4004352, 4005889, 4008064, 4008450,
    4008768, 4046849, 4046976, 4047009, 4047872, 4047905, 4047968, 4048001,
    4048032, 4048097, 4048128, 4048161, 4048480, 4048513, 4048640, 4048673,
    4048704, 4048737, 4048768, 4048961, 4048992, 4049121, 4049152, 4049185,
    4049216, 4049249, 4049280, 4049313, 4049408, 4049441, 4049504, 4049537,
    4049568, 4049633, 4049664, 4049697, 4049728, 4049761, 4049792, 4049825,
    4049856, 4049889, 4049920, 4049953, 4050016, 4050049, 4050080, 4050145,
    4050272, 4050305, 4050528, 4050561, 4050688, 4050721, 4050848, 4050881,
    4050912, 4050945, 4051264, 4051297, 4051840, 4052001, 4052096, 4052129,
    4052288, 4052321, 4052864, 4071427, 4071840, 4194305, 5561056, 5562369,
    5695136, 5695489, 5702592, 5702657, 5887040, 6225921, 6243264, std::numeric_limits<uint32>::max()};

UnicodeSimpleCategory get_unicode_simple_category(uint32 code) {
  auto it = std::upper_bound(std::begin(unicode_simple_category_ranges), std::end(unicode_simple_category_ranges),
                             (code << 5) + 30);
  return static_cast<UnicodeSimpleCategory>(*(it - 1) & 31);
}

}  // end of namespace td
